"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deploy = void 0;
const deploy_1 = require("../defender/deploy");
async function deploy(hre, opts, factory, ...args) {
    // defender always includes RemoteDeploymentId, while ethers always includes DeployTransaction
    if (opts?.useDefenderDeploy) {
        return await (0, deploy_1.defenderDeploy)(hre, factory, opts, ...args);
    }
    else {
        if (opts.txOverrides !== undefined) {
            args.push(opts.txOverrides);
        }
        return await ethersDeploy(factory, ...args);
    }
}
exports.deploy = deploy;
async function ethersDeploy(factory, ...args) {
    const contractInstance = await factory.deploy(...args);
    const deployTransaction = contractInstance.deploymentTransaction();
    if (deployTransaction === null) {
        throw new Error('Broken invariant: deploymentTransaction is null');
    }
    const address = await contractInstance.getAddress();
    const txHash = deployTransaction.hash;
    return { address, txHash, deployTransaction };
}
//# sourceMappingURL=deploy.js.map