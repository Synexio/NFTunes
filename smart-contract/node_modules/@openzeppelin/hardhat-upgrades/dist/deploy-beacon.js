"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeDeployBeacon = makeDeployBeacon;
const utils_1 = require("./utils");
const utils_2 = require("./defender/utils");
const ethers_1 = require("./utils/ethers");
const initial_owner_1 = require("./utils/initial-owner");
function makeDeployBeacon(hre, defenderModule) {
    return async function deployBeacon(ImplFactory, opts = {}) {
        (0, utils_2.disableDefender)(hre, defenderModule, opts, deployBeacon.name);
        const { impl } = await (0, utils_1.deployBeaconImpl)(hre, ImplFactory, opts);
        const signer = (0, ethers_1.getSigner)(ImplFactory.runner);
        const UpgradeableBeaconFactory = await (0, utils_1.getUpgradeableBeaconFactory)(hre, signer);
        const initialOwner = await (0, initial_owner_1.getInitialOwner)(opts, signer);
        const beaconDeployment = await (0, utils_1.deploy)(hre, opts, UpgradeableBeaconFactory, impl, initialOwner);
        const beaconContract = (0, ethers_1.attach)(UpgradeableBeaconFactory, beaconDeployment.address);
        // @ts-ignore Won't be readonly because beaconContract was created through attach.
        beaconContract.deployTransaction = beaconDeployment.deployTransaction;
        return beaconContract;
    };
}
//# sourceMappingURL=deploy-beacon.js.map